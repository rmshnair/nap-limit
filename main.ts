namespace SpriteKind {
    export const Deco = SpriteKind.create()
}
function loadMap (col: number, row: number) {
    currentMapCol = col
    currentMapRow = row
    tiles.loadMap(mapMap[row][col])
}
scene.onOverlapTile(SpriteKind.Player, assets.tile`tile33`, function (sprite, location) {
    spawnLocations = location
    updateNapPoint()
})
scene.onOverlapTile(SpriteKind.Player, assets.tile`tile38`, function (sprite, location) {
    spawnLocations = tiles.locationInDirection(location, CollisionDirection.Top)
    updateNapPoint()
})
info.onCountdownEnd(function () {
    story.startCutscene(function () {
        controller.moveSprite(mySprite, 0, 0)
        animation.runImageAnimation(
        mySprite,
        [img`
            ....................
            ....................
            .....3........3.....
            ....313......313....
            ....3313....3133....
            ....331333333133....
            ....311111111113....
            ....311111111113....
            ....311131111313....
            ...33333111311133...
            ....31111133313.....
            .....33331111133....
            ......311111133.....
            ......31311113......
            ......31311113......
            ......31111113......
            .......313313.......
            .......333333.......
            ........3..3........
            ....................
            ....................
            `,img`
            ....................
            ....................
            ....................
            ....................
            ....................
            ....................
            ....................
            ....................
            ..........3.........
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `,img`
            ....................
            ....................
            ...3333.............
            ..311113............
            ..333313............
            ....313.............
            ...3133.............
            ..311113............
            ...3333...3.........
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `,img`
            ....................
            .........3333.......
            ...3333.311113......
            ..311113.33313......
            ..333313..313.......
            ....313..3133.......
            ...3133.311113......
            ..311113.3333.......
            ...3333...3.........
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `,img`
            ....................
            .........3333.......
            ...3333.311113.3333.
            ..311113.33313311113
            ..333313..313..33313
            ....313..3133...313.
            ...3133.311113.3133.
            ..311113.3333.311113
            ...3333...3....3333.
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `],
        200,
        false
        )
        pause(1000)
        animation.runImageAnimation(
        mySprite,
        [img`
            ....................
            ....................
            ...3333.............
            ..311113............
            ..333313............
            ....313.............
            ...3133.............
            ..311113............
            ...3333...3.........
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `,img`
            ....................
            .........3333.......
            ...3333.311113......
            ..311113.33313......
            ..333313..313.......
            ....313..3133.......
            ...3133.311113......
            ..311113.3333.......
            ...3333...3.........
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `,img`
            ....................
            .........3333.......
            ...3333.311113.3333.
            ..311113.33313311113
            ..333313..313..33313
            ....313..3133...313.
            ...3133.311113.3133.
            ..311113.3333.311113
            ...3333...3....3333.
            .........33333333...
            ........313111313...
            ....3333313111113...
            ..33111131311133....
            .33111113333113.....
            ..3311111111113.....
            ..3311111311113.....
            .33111111331113.....
            ..33111113111133....
            ....3333333311113...
            .......3311111313...
            ........3.3333333...
            `],
        200,
        true
        )
        pause(1800)
        animation.stopAnimation(animation.AnimationTypes.All, mySprite)
        loadMap(spawnCol, spawnRow)
        mySprite.setImage(img`
            . . 3 . . . . . . . . 3 . . 
            . 3 1 3 . . . . . . 3 1 3 . 
            . 3 3 1 3 . . . . 3 1 3 3 . 
            . 3 3 1 3 3 3 3 3 3 1 3 3 . 
            . 3 1 1 1 1 1 1 1 1 1 1 3 . 
            . 3 1 1 1 1 1 1 1 1 1 1 3 . 
            . 3 1 1 1 3 1 1 1 1 3 1 3 . 
            3 3 3 3 3 1 1 1 3 1 1 1 3 3 
            . 3 1 1 1 1 1 3 3 3 1 3 . . 
            . . 3 3 3 3 1 1 1 1 1 3 3 . 
            . . . 3 1 1 1 1 1 1 3 3 . . 
            . . . 3 1 3 1 1 1 1 3 . . . 
            . . . 3 1 3 1 1 1 1 3 . . . 
            . . . 3 1 1 1 1 1 1 3 . . . 
            . . . . 3 1 3 3 1 3 . . . . 
            . . . . 3 3 3 3 3 3 . . . . 
            . . . . . 3 . . 3 . . . . . 
            `)
        tiles.placeOnTile(mySprite, spawnLocations)
        controller.moveSprite(mySprite)
        startCountdown()
    })
})
function startCountdown () {
    info.startCountdown(60)
}
function maybeLoadAMap (colChange: number, rowChange: number) {
    if (Math.constrain(colChange + currentMapCol, 0, mapMap[0].length - 1) != currentMapCol || Math.constrain(rowChange + currentMapRow, 0, mapMap.length - 1) != currentMapRow) {
        currentMapCol += colChange
        currentMapRow += rowChange
        loadMap(currentMapCol, currentMapRow)
        if (colChange == -1) {
            mySprite.right = 158
        } else if (colChange == 1) {
            mySprite.left = 2
        } else if (rowChange == -1) {
            mySprite.bottom = 118
        } else {
            mySprite.top = 2
        }
    }
}
function updateNapPoint () {
    if (spawnCol == currentMapCol || spawnRow != currentMapRow) {
        spawnCol = currentMapCol
        spawnRow = currentMapRow
        napPointSet = sprites.create(img`
            .111111111111111111111111111111111111111111111111111111.
            .1111111111111111111111111111111111111111111111111111111
            11311311311331111331113311333131131333111133133313331311
            11331313131313111313131131131133131131111131131111311311
            11313313331331111331131131131131331131111113133111311111
            11311313131311111311113311333131131131111133133311311311
            11111111111111111111111111111111111111111111111111111111
            .111111111111111111111111111111111111111111111111111111.
            `, SpriteKind.Deco)
        napPointSet.bottom = 115
        napPointSet.lifespan = 1000
    }
}
let napPointSet: Sprite = null
let spawnLocations: tiles.Location = null
let currentMapCol = 0
let spawnRow = 0
let spawnCol = 0
let mapMap: tiles.WorldMap[][] = []
let currentMapRow = 0
let mySprite: Sprite = null
startCountdown()
scene.setBackgroundColor(3)
mySprite = sprites.create(img`
    . . 3 . . . . . . . . 3 . . 
    . 3 1 3 . . . . . . 3 1 3 . 
    . 3 3 1 3 . . . . 3 1 3 3 . 
    . 3 3 1 3 3 3 3 3 3 1 3 3 . 
    . 3 1 1 1 1 1 1 1 1 1 1 3 . 
    . 3 1 1 1 1 1 1 1 1 1 1 3 . 
    . 3 1 1 1 3 1 1 1 1 3 1 3 . 
    3 3 3 3 3 1 1 1 3 1 1 1 3 3 
    . 3 1 1 1 1 1 3 3 3 1 3 . . 
    . . 3 3 3 3 1 1 1 1 1 3 3 . 
    . . . 3 1 1 1 1 1 1 3 3 . . 
    . . . 3 1 3 1 1 1 1 3 . . . 
    . . . 3 1 3 1 1 1 1 3 . . . 
    . . . 3 1 1 1 1 1 1 3 . . . 
    . . . . 3 1 3 3 1 3 . . . . 
    . . . . 3 3 3 3 3 3 . . . . 
    . . . . . 3 . . 3 . . . . . 
    `, SpriteKind.Player)
controller.moveSprite(mySprite)
currentMapRow = 0
currentMapRow += 0
mapMap = [
[tiles.createMap(tilemap`level1`), tiles.createMap(tilemap`level43`), tiles.createMap(tilemap`level39`)],
[tiles.createMap(tilemap`level2`), tiles.createMap(tilemap`level37`), tiles.createMap(tilemap`level42`)],
[tiles.createMap(tilemap`level3`), tiles.createMap(tilemap`level40`), tiles.createMap(tilemap`level38`)],
[tiles.createMap(tilemap`level25`), tiles.createMap(tilemap`level36`), tiles.createMap(tilemap`level41`)],
[tiles.createMap(tilemap`level26`), tiles.createMap(tilemap`level34`), tiles.createMap(tilemap`level35`)],
[tiles.createMap(tilemap`level28`), tiles.createMap(tilemap`level32`), tiles.createMap(tilemap`level33`)],
[tiles.createMap(tilemap`level29`), tiles.createMap(tilemap`level30`), tiles.createMap(tilemap`level31`)]
]
spawnCol = 0
spawnRow = 0
loadMap(2, 5)
tiles.placeOnRandomTile(mySprite, assets.tile`tile33`)
game.onUpdate(function () {
    if (mySprite.left < 2) {
        maybeLoadAMap(-1, 0)
    } else if (mySprite.top < 2) {
        maybeLoadAMap(0, -1)
    } else if (mySprite.right > 158) {
        maybeLoadAMap(1, 0)
    } else if (mySprite.bottom > 118) {
        maybeLoadAMap(0, 1)
    }
})
